<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†ØªØ§Ø¦Ø¬ Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø­ØµØ§ÙŠØ§ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #e67e22; --bg: #fdf5e6; }
        body { font-family: 'Cairo', sans-serif; background: var(--bg); margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 500px; margin: auto; background: white; padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        h1 { color: var(--primary); margin-bottom: 10px; }
        input { width: 100%; padding: 15px; margin: 15px 0; border: 2px solid #eee; border-radius: 12px; text-align: center; font-family: 'Cairo'; font-size: 18px; }
        button { width: 100%; padding: 15px; background: var(--primary); color: white; border: none; border-radius: 12px; font-weight: bold; cursor: pointer; font-size: 18px; }
        #status { font-size: 12px; margin-top: 10px; color: #888; }
        .result-card { margin-top: 25px; background: #fff; padding: 20px; border-radius: 20px; border: 1px solid #eee; text-align: right; }
        table { width: 100%; margin-top: 15px; border-collapse: collapse; }
        th, td { padding: 10px; border: 1px solid #f2f2f2; text-align: center; }
        th { background: var(--primary); color: white; }
    </style>
</head>
<body>

<div class="container">
    <h1>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø­ØµØ§ÙŠØ§ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© ğŸ«</h1>
    <p>Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ Ù„Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù… Ø¹Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©</p>

    <input type="text" id="seatNum" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ Ù‡Ù†Ø§">
    <button onclick="search()">Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>
    
    <div id="status">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</div>
    <div id="resultArea"></div>
</div>

<script>
    // ğŸ”— Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù„ÙŠ Ø¥Ù†ØªÙŠ Ø¨Ø¹ØªÙŠÙ‡ Ø­Ø·ÙŠØªÙ‡ÙˆÙ„Ùƒ Ù‡Ù†Ø§
    const driveUrl = "https://drive.google.com/file/d/1_OJ_JZLOb5oMTZaof0bHro9GW7qzxJdZ/view?usp=drivesdk";
    
    // ØªØ­ÙˆÙŠÙ„ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯Ø±Ø§ÙŠÙ Ù„Ø±Ø§Ø¨Ø· ØªØ­Ù…ÙŠÙ„ Ù…Ø¨Ø§Ø´Ø± Ø¹Ø´Ø§Ù† Ø§Ù„ÙƒÙˆØ¯ ÙŠÙ‚Ø±Ø£Ù‡
    const fileId = driveUrl.match(/[-\w]{25,}/);
    const downloadUrl = `https://docs.google.com/spreadsheets/d/${fileId}/export?format=csv`;

    let studentDB = [];

    // ÙˆØ¸ÙŠÙØ© Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø±Ø§Ø¨Ø· Ø£ÙˆØªÙˆÙ…Ø§ØªÙŠÙƒÙŠØ§Ù‹
    async function loadData() {
        try {
            const response = await fetch(downloadUrl);
            const data = await response.text();
            const workbook = XLSX.read(data, {type: 'string'});
            const sheet = workbook.Sheets[workbook.SheetNames[0]];
            studentDB = XLSX.utils.sheet_to_json(sheet);
            document.getElementById('status').innerText = "âœ… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…ØªØµÙ„Ø© ÙˆØ¬Ø§Ù‡Ø²Ø©";
        } catch (error) {
            document.getElementById('status').innerText = "âŒ ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø¬Ø¹Ù„ Ù…Ù„Ù Ø§Ù„Ø¯Ø±Ø§ÙŠÙ (Anyone with the link can view)";
            console.error(error);
        }
    }

    loadData();

    function search() {
        const code = document.getElementById('seatNum').value.trim();
        const output = document.getElementById('resultArea');

        if (studentDB.length === 0) {
            alert("Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù… ØªÙƒØªÙ…Ù„ Ø¨Ø¹Ø¯ØŒ Ø§Ù†ØªØ¸Ø± Ø«ÙˆØ§Ù†ÙŠ.");
            return;
        }

        // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø°ÙƒØ§Ø¡ Ø¹Ù† "Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³"
        const student = studentDB.find(s => {
            for(let key in s) {
                if((key.includes("Ø¬Ù„ÙˆØ³") || key.includes("Ø±Ù‚Ù…")) && String(s[key]) === code) return true;
            }
            return false;
        });

        if (student) {
            let name = "";
            for(let key in student) { if(key.includes("Ø§Ø³Ù…")) name = student[key]; }

            let html = `<div class="result-card"><h3>Ø§Ù„Ø§Ø³Ù…: ${name}</h3><table><tr><th>Ø§Ù„Ù…Ø§Ø¯Ø©</th><th>Ø§Ù„Ø¯Ø±Ø¬Ø©</th></tr>`;
            for (let key in student) {
                if (!key.includes("Ø§Ø³Ù…") && !key.includes("Ø¬Ù„ÙˆØ³") && !key.includes("Ø±Ù‚Ù…")) {
                    html += `<tr><td>${key}</td><td>${student[key]}</td></tr>`;
                }
            }
            html += `</table></div>`;
            output.innerHTML = html;
        } else {
            output.innerHTML = "<p style='color:red; margin-top:20px;'>Ø±Ù‚Ù… Ø§Ù„Ø¬Ù„ÙˆØ³ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯!</p>";
        }
    }
</script>

</body>
</html>
